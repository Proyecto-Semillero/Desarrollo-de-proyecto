trigger:
  branches:
    include:
      - main

pr:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  SONAR_TOKEN: $(SONAR_TOKEN)  # Define esto como variable secreta en Azure DevOps

steps:

# ğŸ” Paso 1: SonarCloud - Preparar anÃ¡lisis
- task: SonarCloudPrepare@1
  inputs:
    SonarCloud: 'SonarCloud Connection'  # Nombre del servicio conectado
    organization: 'tu-organizacion'      # Nombre en SonarCloud
    scannerMode: 'CLI'
    configMode: 'manual'
    cliProjectKey: 'tu-proyecto'
    cliProjectName: 'tu-proyecto'
    cliSources: '.'

# ğŸ” Paso 2: SonarCloud - Ejecutar anÃ¡lisis
- task: SonarCloudAnalyze@1

# ğŸ” Paso 3: SonarCloud - Publicar resultados
- task: SonarCloudPublish@1
  inputs:
    pollingTimeoutSec: '300'

# ğŸ§ª Paso 4: Pruebas unitarias (ejemplo con Node.js + Jest)
- script: |
    npm install
    npm test
  displayName: 'Ejecutar pruebas unitarias con Jest'